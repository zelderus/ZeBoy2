C51 COMPILER V9.55   LCD                                                                   04/08/2016 10:56:52 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN .\Objects\lcd.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE lcd.c LARGE OPTIMIZE(8,SPEED) PRINT(.\Listings\lcd.lst) TABS(2) OBJECT(.
                    -\Objects\lcd.obj)

line level    source

   1          #include <REG2051.H>
   2          #include <common.h>
   3          #include <lcd.h>
   4          
   5          
   6          
   7          
   8          #define __PORTA    P1
   9          #define __PORTB    P3
  10          
  11          
  12            
  13          #define LCD_E_on      __PORTB=SetBit(__PORTB,0)
  14          #define LCD_RES_on    __PORTB=SetBit(__PORTB,4)
  15          #define LCD_CS_on     __PORTB=SetBit(__PORTB,3)
  16          #define LCD_RW_on     __PORTB=SetBit(__PORTB,1)
  17          
  18          #define LCD_E_off       __PORTB=ClrBit(__PORTB,0)
  19          #define LCD_RES_off     __PORTB=ClrBit(__PORTB,4)
  20          #define LCD_CS_off      __PORTB=ClrBit(__PORTB,3)
  21          #define LCD_RW_off      __PORTB=ClrBit(__PORTB,1)
  22          
  23          
  24          
  25          void LCD_A0(int b)      
  26          {
  27   1        //MutBit(__PORTB,5,b);
  28   1        if(b>=1)(__PORTB|=(1<<5));
  29   1        else (__PORTB&=~(1<<5));
  30   1      }
  31          void LCD_CS(int b)      
  32          {
  33   1        //MutBit(__PORTB,3,b);
  34   1        if(b>=1)(__PORTB|=(1<<3));
  35   1        else (__PORTB&=~(1<<3));
  36   1      }
  37          
  38          void LCD_SetD(int b)      
  39          {
  40   1        //PutByte(__PORTA,b);
  41   1        __PORTA = b;
  42   1      }
  43          //#define LCD_GetD()        GetByte(__PORTA)
  44          
  45          
  46          
  47          
  48          
  49          
  50          
  51          
  52          //–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
  53          void LCDinit(BOOL fromProt) 
  54          {
C51 COMPILER V9.55   LCD                                                                   04/08/2016 10:56:52 PAGE 2   

  55   1        LCD_E_on;//–ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—É
  56   1        LCD_RES_off;//–í—ã–¥–∞—Ç—å —Å–∏–≥–Ω–∞–ª RES=0 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—É
  57   1        delayUs(10);//–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –≤—Ä–µ–º—è –±–æ–ª—å—à–µ 10 –º–∫—Å
  58   1        LCD_RES_on;//–°–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª RES
  59   1        delayMs(1);//–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –≤—Ä–µ–º—è –±–æ–ª—å—à–µ 1 –º—Å
  60   1        WriteCodeL(0xE2);//Reset
  61   1        WriteCodeR(0xE2);//Reset
  62   1        WriteCodeL(0xEE);//ReadModifyWrite off
  63   1        WriteCodeR(0xEE);//ReadModifyWrite off
  64   1        WriteCodeL(0xA4);//–í–∫–ª—é—á–∏—Ç—å –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
  65   1        WriteCodeR(0xA4);//–í–∫–ª—é—á–∏—Ç—å –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º
  66   1        WriteCodeL(0xA9);//–ú—É–ª—å—Ç–∏–ø–ª–µ–∫—Å 1/32
  67   1        WriteCodeR(0xA9);//–ú—É–ª—å—Ç–∏–ø–ª–µ–∫—Å 1/32
  68   1        WriteCodeL(0xC0);//–í–µ—Ä—Ö–Ω—é—é —Å—Ç—Ä–æ–∫—É –Ω–∞ 0
  69   1        WriteCodeR(0xC0);//–í–µ—Ä—Ö–Ω—é—é —Å—Ç—Ä–æ–∫—É –Ω–∞ 0
  70   1        WriteCodeL(0xA1);//Invert scan RAM
  71   1        //NonInvert scan RAM
  72   1        if (fromProt == FALSE)
  73   1          WriteCodeR(0xA0);
  74   1        else
  75   1          WriteCodeR(0xA1);
  76   1        
  77   1        
  78   1        //Display on
  79   1        WriteCodeL(0xAF);//Display on
  80   1        WriteCodeR(0xAF);//Display on
  81   1      }
  82          
  83          
  84          void WriteCodeL(int b) { WriteByte(b,0,1); }//–ö–æ–º–∞–Ω–¥—É –≤ –ª–µ–≤—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª –∏–Ω–¥–∏–∫–∞—Ç
             -–æ—Ä–∞
  85          void WriteCodeR(int b) { WriteByte(b,0,0); }//–ö–æ–º–∞–Ω–¥—É –≤ –ø—Ä–∞–≤—ã–π –∫—Ä–∏—Å—Ç–∞–ª–ª –∏–Ω–¥–∏–∫–∞
             -—Ç–æ—Ä–∞
  86          
  87          void WriteDataL(int b) { WriteByte(b,1,1); }//–î–∞–Ω–Ω—ã–µ –≤ –ª–µ–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–∫–∞—Ç–æ
             -—Ä–∞
  88          void WriteDataR(int b) { WriteByte(b,1,0); }//–î–∞–Ω–Ω—ã–µ –≤ –ø—Ä–∞–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–∫–∞—Ç
             -–æ—Ä–∞
  89          
  90          //–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –≤—ã–¥–∞—á–∏ –±–∞–π—Ç–∞ –≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
  91          void WriteByte(int b, bit cd, bit lr) {
  92   1      //–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–¥–µ—Å—å —à–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—ã–≤–æ–¥
  93   1        LCD_RW_off; 
  94   1        LCD_A0(cd);
  95   1        LCD_CS(lr);
  96   1        LCD_SetD(b);
  97   1        delayNs(40);    //–≠—Ç–æ –≤—Ä–µ–º—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–¥—Ä–µ—Å–∞ (tAW)
  98   1        LCD_E_off; 
  99   1        delayNs(160); //–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–≥–Ω–∞–ª–∞ E=0 (–≤—Ä–µ–º—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–∞–Ω
             -–Ω—ã—Ö –ø–æ–ø–∞–ª–æ —Å—é–¥–∞ (tDS))
 100   1        LCD_E_on;   //–°–±—Ä–æ—Å–∏—Ç—å —Å–∏–≥–Ω–∞–ª E –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—É
 101   1        //Delay(>(2000ns-40ns-160ns));  //–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –¥–æ–ø—É—Å—Ç–∏–º—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å
             -–∏–≥–Ω–∞–ª–∞–º–∏ E=0
 102   1      }
 103          
 104          
 105          void LCDclear() {
 106   1        int p = 0;//–ù–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 107   1        int c = 0;//–ü–æ–∑–∏—Ü–∏—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –≤—ã–≤–æ–¥–∏–º–æ–≥–æ –±–∞–π—Ç–∞
 108   1        int clearSymb = 0x00;
 109   1        
 110   1        // reset LCD addr
C51 COMPILER V9.55   LCD                                                                   04/08/2016 10:56:52 PAGE 3   

 111   1        WriteCodeL(0xE2);
 112   1        WriteCodeR(0xE2);
 113   1        
 114   1        for(p=0; p<4; p++) {//–¶–∏–∫–ª –ø–æ –≤—Å–µ–º 4-–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 115   2          WriteCodeL(p|0xB8);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ª–µ–≤–æ–≥–æ –∫—Ä–∏—Å—Ç–∞
             -–ª–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 116   2          WriteCodeL(0x13);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ 
             -–ª–µ–≤—É—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—É—é –ø–æ–∑–∏—Ü–∏—é –ª–µ–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 117   2          for(c=0; c<61; c++) {//–¶–∏–∫–ª –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–µ–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–∫–∞—Ç–
             -æ—Ä–∞
 118   3            WriteDataL(clearSymb);
 119   3          }
 120   2          WriteCodeR(p|0xB8);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∏—Å—Ç
             -–∞–ª–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 121   2          WriteCodeR(0x00);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ 
             -–ª–µ–≤—É—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—É—é –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∞–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 122   2          for(c=61; c<122; c++) {//–¶–∏–∫–ª –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∞–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–∫–
             -∞—Ç–æ—Ä–∞
 123   3            WriteDataR(clearSymb);
 124   3          }
 125   2        }
 126   1      }
 127          
 128          
 129          void LCDdraw(BYTE video[][122]){
 130   1        
 131   1        int p = 0;
 132   1        int c = 0;
 133   1      
 134   1        // reset LCD addr
 135   1        WriteCodeL(0xE2);
 136   1        WriteCodeR(0xE2);
 137   1        
 138   1        for(p=0; p<4; p++) {//–¶–∏–∫–ª –ø–æ –≤—Å–µ–º 4-–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 139   2          //WriteCodeL(0xE2); // reset
 140   2          WriteCodeL(p|0xB8);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ª–µ–≤–æ–≥–æ –∫—Ä–∏—Å—Ç–∞
             -–ª–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 141   2          WriteCodeL(0x13);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ 
             -–ª–µ–≤—É—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—É—é –ø–æ–∑–∏—Ü–∏—é –ª–µ–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 142   2          for(c=0; c<61; c++) {//–¶–∏–∫–ª –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–µ–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–∫–∞—Ç–
             -æ—Ä–∞
 143   3            WriteDataL(video[p][c]);//–í—ã–≤–æ–¥ –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ –±–∞–π—Ç–∞ –≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
 144   3          }
 145   2          //WriteCodeR(0xE2); // reset
 146   2          WriteCodeR(p|0xB8);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∏—Å—Ç
             -–∞–ª–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 147   2          WriteCodeR(0x00);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ 
             -–ª–µ–≤—É—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—É—é –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∞–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 148   2          for(c=61; c<122; c++) {//–¶–∏–∫–ª –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∞–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–∫–
             -∞—Ç–æ—Ä–∞
 149   3            WriteDataR(video[p][c]);
 150   3          }
 151   2        }
 152   1        
 153   1      }
 154          
 155          
 156          void LCDdrawLeftOnly(BYTE video[][122])
 157          {
 158   1          
 159   1        int p = 0;
 160   1        int c = 0;
C51 COMPILER V9.55   LCD                                                                   04/08/2016 10:56:52 PAGE 4   

 161   1        
 162   1        // reset LCD addr
 163   1        //WriteCodeL(0xE2);
 164   1        //WriteCodeR(0xE2);
 165   1        
 166   1        for(p=0; p<4; p++) {//–¶–∏–∫–ª –ø–æ –≤—Å–µ–º 4-–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 167   2          WriteCodeL(0xE2); // reset
 168   2          
 169   2          WriteCodeL(p|0xB8);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ª–µ–≤–æ–≥–æ –∫—Ä–∏—Å—Ç–∞
             -–ª–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 170   2          WriteCodeL(0x13);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ 
             -–ª–µ–≤—É—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—É—é –ø–æ–∑–∏—Ü–∏—é –ª–µ–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 171   2          for(c=0; c<61; c++) {//–¶–∏–∫–ª –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–µ–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–∫–∞—Ç–
             -æ—Ä–∞
 172   3            WriteDataL(video[p][c]);//–í—ã–≤–æ–¥ –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ –±–∞–π—Ç–∞ –≤ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
 173   3          }
 174   2          
 175   2          //WriteCodeR(0xE2); // reset
 176   2          //WriteCodeR(p|0xB8);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–∞–≤–æ–≥–æ –∫—Ä–∏—Å
             -—Ç–∞–ª–ª–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 177   2          //WriteCodeR(0x00);//–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –
             -≤ –ª–µ–≤—É—é –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—É—é –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∞–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 178   2          //for(c=61; c<122; c++) {//–¶–∏–∫–ª –≤—ã–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∞–≤—É—é –ø–æ–ª–æ–≤–∏–Ω—É –∏–Ω–¥–∏–
             -∫–∞—Ç–æ—Ä–∞
 179   2          //  WriteDataR(video[p][c]);
 180   2          //}
 181   2        }
 182   1        
 183   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    970    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      24
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       2
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
